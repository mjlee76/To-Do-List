<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ì˜ ToDoList</title>
    <link rel="stylesheet" th:href="@{/css/todolist.css}">
</head>
<body>
<header>
    <h2>ë‚˜ì˜ ToDoList</h2>
    <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
    <form th:action="@{/logout}" method="post" class="logout-form">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <button type="submit" class="logout-button">ë¡œê·¸ì•„ì›ƒ</button>
    </form>
</header>

<div class="container">
    <div class="todo-card">
        <div class="todo-header">
            <h3>í•  ì¼ ëª©ë¡</h3>
            <div class="todo-stats">
                <div class="stat-item">
                    <span class="stat-number" id="totalTasks">3</span>
                    <span class="stat-label">ì „ì²´</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="completedTasks">0</span>
                    <span class="stat-label">ì™„ë£Œ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="remainingTasks">3</span>
                    <span class="stat-label">ë‚¨ì€ ì¼</span>
                </div>
            </div>
        </div>

        <div class="add-task-section">
            <div class="add-task-form" id="addTaskForm">
                <input
                        type="text"
                        class="task-input"
                        id="taskInput"
                        placeholder="ìƒˆ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”..."
                        required
                >
                <button type="button" class="add-button">
                    ì¶”ê°€
                </button>
            </div>
        </div>

        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">ì „ì²´</button>
            <button class="filter-btn" data-filter="active">ì§„í–‰ ì¤‘</button>
            <button class="filter-btn" data-filter="completed">ì™„ë£Œ</button>
        </div>

        <div class="todo-list" id="todoList">
            <div class="todo-item">
                <div class="todo-checkbox" onclick="toggleTask(this)"></div>
                <div class="todo-text">ì˜ˆì‹œ í•  ì¼ 1</div>
                <div class="todo-actions">
                    <button class="action-btn" onclick="deleteTask(this)" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                </div>
            </div>
            <div class="todo-item">
                <div class="todo-checkbox" onclick="toggleTask(this)"></div>
                <div class="todo-text">ì˜ˆì‹œ í•  ì¼ 2</div>
                <div class="todo-actions">
                    <button class="action-btn" onclick="deleteTask(this)" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                </div>
            </div>
            <div class="todo-item">
                <div class="todo-checkbox" onclick="toggleTask(this)"></div>
                <div class="todo-text">ì˜ˆì‹œ í•  ì¼ 3</div>
                <div class="todo-actions">
                    <button class="action-btn" onclick="deleteTask(this)" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let tasks = [];
    let currentFilter = 'all';

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
        // ê¸°ì¡´ í•  ì¼ë“¤ì„ tasks ë°°ì—´ì— ì¶”ê°€
        const existingTasks = document.querySelectorAll('.todo-item');
        existingTasks.forEach((item, index) => {
            tasks.push({
                id: index + 1,
                text: item.querySelector('.todo-text').textContent,
                completed: false
            });
        });
        updateStats();
    });

    // í•  ì¼ ì¶”ê°€
    document.querySelector('.add-button').addEventListener('click', function() {
        const input = document.getElementById('taskInput');
        const text = input.value.trim();

        if (text) {
            const task = {
                id: Date.now(),
                text: text,
                completed: false
            };

            tasks.push(task);
            addTaskToDOM(task);
            input.value = '';
            updateStats();

            // ì…ë ¥ í›„ ì• ë‹ˆë©”ì´ì…˜
            input.style.transform = 'scale(0.95)';
            setTimeout(() => {
                input.style.transform = 'scale(1)';
            }, 100);
        }
    });

    // DOMì— í•  ì¼ ì¶”ê°€
    function addTaskToDOM(task) {
        const todoList = document.getElementById('todoList');
        const taskElement = document.createElement('div');
        taskElement.className = 'todo-item' + (task.completed ? ' completed' : '');
        taskElement.dataset.taskId = task.id;

        taskElement.innerHTML = `
                <div class="todo-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask(this)"></div>
                <div class="todo-text">${task.text}</div>
                <div class="todo-actions">
                    <button class="action-btn" onclick="deleteTask(this)" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                </div>
            `;

        todoList.appendChild(taskElement);
    }

    // í•  ì¼ ì™„ë£Œ/ë¯¸ì™„ë£Œ í† ê¸€
    function toggleTask(checkbox) {
        const taskElement = checkbox.closest('.todo-item');
        const taskId = parseInt(taskElement.dataset.taskId);
        const task = tasks.find(t => t.id === taskId);

        if (task) {
            task.completed = !task.completed;
            checkbox.classList.toggle('checked');
            taskElement.classList.toggle('completed');
            updateStats();

            // ì™„ë£Œ íš¨ê³¼
            if (task.completed) {
                taskElement.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    taskElement.style.transform = 'scale(1)';
                }, 200);
            }
        }
    }

    // í•  ì¼ ì‚­ì œ
    function deleteTask(button) {
        const taskElement = button.closest('.todo-item');
        const taskId = parseInt(taskElement.dataset.taskId);

        // ì‚­ì œ ì• ë‹ˆë©”ì´ì…˜
        taskElement.style.transform = 'translateX(-100%)';
        taskElement.style.opacity = '0';

        setTimeout(() => {
            tasks = tasks.filter(task => task.id !== taskId);
            taskElement.remove();
            updateStats();
            checkEmptyState();
        }, 300);
    }

    // í†µê³„ ì—…ë°ì´íŠ¸
    function updateStats() {
        const total = tasks.length;
        const completed = tasks.filter(task => task.completed).length;
        const remaining = total - completed;

        document.getElementById('totalTasks').textContent = total;
        document.getElementById('completedTasks').textContent = completed;
        document.getElementById('remainingTasks').textContent = remaining;
    }

    // í•„í„° ê¸°ëŠ¥
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentFilter = this.dataset.filter;
            filterTasks();
        });
    });

    function filterTasks() {
        const taskElements = document.querySelectorAll('.todo-item');

        taskElements.forEach(element => {
            const taskId = parseInt(element.dataset.taskId);
            const task = tasks.find(t => t.id === taskId);

            if (!task) return;

            let shouldShow = true;

            switch(currentFilter) {
                case 'active':
                    shouldShow = !task.completed;
                    break;
                case 'completed':
                    shouldShow = task.completed;
                    break;
                case 'all':
                default:
                    shouldShow = true;
                    break;
            }

            element.style.display = shouldShow ? 'flex' : 'none';
        });

        checkEmptyState();
    }

    // ë¹ˆ ìƒíƒœ í™•ì¸
    function checkEmptyState() {
        const todoList = document.getElementById('todoList');
        const visibleTasks = todoList.querySelectorAll('.todo-item[style*="display: flex"], .todo-item:not([style*="display: none"])');
        const existingEmptyState = todoList.querySelector('.empty-state');

        if (visibleTasks.length === 0 && !existingEmptyState) {
            const emptyState = document.createElement('div');
            emptyState.className = 'empty-state';
            emptyState.innerHTML = `
                    <div class="empty-state-icon">ğŸ“</div>
                    <p>í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    <p>ìƒˆë¡œìš´ í•  ì¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
                `;
            todoList.appendChild(emptyState);
        } else if (visibleTasks.length > 0 && existingEmptyState) {
            existingEmptyState.remove();
        }
    }

    // Enter í‚¤ë¡œ í•  ì¼ ì¶”ê°€
    document.getElementById('taskInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            document.querySelector('.add-button').click();
        }
    });

    // ì´ˆê¸° ë¹ˆ ìƒíƒœ í™•ì¸
    setTimeout(checkEmptyState, 100);
</script>
</body>
</html>